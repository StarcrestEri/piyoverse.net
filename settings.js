// Simple i18n dictionary
var I18N = {
    en: {
      'nav-home': 'Home',
      'nav-marketplace': 'Marketplace',
      'nav-about': 'About',
      'nav-settings': 'Settings',
      'home-welcome': 'Welcome to Piyoverse.net',
      'upcoming-release': 'Upcoming Release:',
      'em-starcrest': 'Starcrest',
      'upcoming-desc': 'Get ready for an epic adventure! Starcrest is an upcoming creation from Piyoverse Entertainment, only for the Mega Drive.',
      'other-games': 'Other Games & Media',
      'explore-catalog': 'Explore our catalog of games, videos, and other creative media. Stay tuned for new updates and releases!',
      'starcrest-md': 'Starcrest (Mega Drive)',
      'starcrest-gbc': 'Starcrest Adventure (Gameboy Color)',
      'music': 'Music',
      'about-heading': 'About Piyoverse Entertainment',
      'about-desc': 'Piyoverse Entertainment is dedicated to creating innovative games and media experiences. We focus on high-quality gameplay, beautiful visuals, and memorable music.',
      'footer-copy': '© 2025 Piyoverse Entertainment. All rights reserved.',
      'legal-note': 'STARCREST, STARCREST ADVENTURE, ALIA, the PVE logo, the STARCREST logo, and all affiliated logos, characters, and distinctive marks are trademarks and/or registered trademarks of Piyoverse Entertainment. All rights are reserved.',
      'about-page-name': 'About',
      'marketplace-page-name': 'Marketplace',
      'games-page-name': 'Games',
      'music-page-name': 'Music',
      'settings-title': 'Settings',
      'settings-header': 'Site Settings',
      'settings-audio-header': 'Audio Settings',
      'settings-display-header': 'Display & Accessibility',
      'label-reduce-transparency': 'Reduce transparency:',
      'label-reduce-animation': 'Reduce animation:',
      'label-disable-ribbons': 'Disable ribbon and sparkles:',
      'label-black-text': 'Use black text',
      'label-language': 'Language:',
      'label-theme-mode': 'Theme Mode:',
      'label-theme': 'Theme:',
      'theme-dark': 'Dark Mode',
      'theme-light': 'Light Mode',
      'btn-save': 'Save Settings',
      'social-youtube': 'YouTube',
      'social-discord': 'Discord',
      'social-bsky': 'Bluesky',
      'social-twt': 'Twitter',
      'theme-obsidian': 'Obsidian',
      'theme-blood-maroon': 'Blood Maroon',
      'theme-brown-smog': 'Brown Smog',
      'theme-ocean-abyss': 'Ocean Abyss',
      'theme-forest-green': 'Forest Green',
      'theme-mystic-teal': 'Mystic Teal',
      'theme-lime-lemon': 'Lime-Lemon',
      'theme-trans-pride': 'Trans Pride',
      'theme-radiant-amethyst': 'Radiant Amethyst',
      'theme-pride-rainbow': 'Rainbow Pride',
      'theme-lesbian-pride': 'Lesbian Pride',
      'theme-bisexual-pride': 'Bisexual Pride',
      'theme-asexual-pride': 'Asexual Pride',
      'theme-opal': 'Opal',
      'theme-fire-red': 'Fire Red',
      'theme-orange-citrus': 'Orange Citrus',
      'theme-baby-blue': 'Baby Blue',
      'theme-passive-pink': 'Passive Pink',
      'theme-cyan-bliss': 'Cyan Bliss',
      'theme-lemon-lime': 'Lemon-Lime',
      'theme-sparkling-amethyst': 'Sparkling Amethyst'
    ,
      'theme-pansexual-pride': 'Pansexual Pride',
      'theme-pansexual-joy': 'Pansexual Joy',
      'theme-aromantic-pride': 'Aromantic Pride',
      'theme-aromantic-joy': 'Aromantic Joy',
      'theme-genderfluid-pride': 'Genderfluid Pride',
      'theme-genderfluid-joy': 'Genderfluid Joy',
      'theme-pomosexual-pride': 'Pomosexual Pride',
      'theme-pomosexual-joy': 'Pomosexual Joy',
      'theme-asexual-pride': 'Asexual Pride',
      'theme-pride-rainbow-joy': 'Rainbow Joy',
      'theme-lesbian-joy': 'Lesbian Joy',
      'theme-bisexual-joy': 'Bisexual Joy',
      'theme-asexual-joy': 'Asexual Joy',
      'theme-trans-joy': 'Trans Joy'
    },
    ja: {
      'nav-home': 'ホーム',
      'nav-marketplace': 'マーケット',
      'nav-about': '概要',
      'nav-settings': '設定',
      'home-welcome': 'ピヨバースへようこそ',
      'upcoming-release': '今後のリリース：',
      'upcoming-desc': '壮大な冒険の準備をしてください！StarcrestはPiyoverse EntertainmentによるMega Drive専用の新作です。',
      'em-starcrest': 'スタークレスト',
      'other-games': 'その他のゲームとメディア',
      'explore-catalog': 'ゲーム、ビデオ、その他のクリエイティブなメディアのカタログをチェックしてください。新しいアップデートやリリースにご期待ください！',
      'starcrest-md': 'スタークレスト（メガドライブ）',
      'starcrest-gbc': 'スタークレスト アドベンチャー（ゲームボーイカラー）',
      'music': '音楽',
      'about-heading': 'ピヨバース・エンターテインメントについて',
      'about-desc': 'ピヨバース・エンターテインメント（Piyoverse Entertainment）は革新的なゲームとメディア体験の創造に注力しています。高品質なゲームプレイ、美しいビジュアル、記憶に残る音楽に重点を置いています。',
      'footer-copy': '© 2025 ピヨバース・エンターテインメント（Piyoverse Entertainment）。全著作権所有。',
      'legal-note': 'スタークレスト、STARCREST ADVENTURE、ALIA、PVEロゴ、スタークレストロゴ、および関連するロゴ、キャラクター、固有のマークはピヨバース・エンターテインメント（Piyoverse Entertainment）の商標または登録商標です。全ての権利を保有します。',
      'about-page-name': '概要',
      'marketplace-page-name': 'マーケット',
      'games-page-name': 'ゲーム',
      'music-page-name': '音楽',
      'settings-title': '設定',
      'settings-header': 'サイト設定',
      'settings-audio-header': 'オーディオ設定',
      'settings-display-header': '表示とアクセシビリティ',
      'label-reduce-transparency': '透明度を減らす:',
      'label-reduce-animation': 'アニメーションを減らす:',
      'label-disable-ribbons': 'リボンと輝きを無効にする:',
      'label-black-text': '黒いテキストを使用',
      'label-language': '言語：',
      'label-theme-mode': 'テーマモード：',
      'label-theme': 'テーマ：',
      'theme-dark': 'ダークモード',
      'theme-light': 'ライトモード',
      'btn-save': '設定を保存',
      'social-youtube': 'ユーチューブ',
      'social-discord': 'ディスコード',
      'social-bsky': 'ブルースカイ',
      'social-twt': 'ツイッター',
      'theme-obsidian': 'オブシディアン',
      'theme-blood-maroon': 'ブラッド・マルーン',
      'theme-brown-smog': 'ブラウン・スモッグ',
      'theme-ocean-abyss': 'オーシャン・アビス',
      'theme-forest-green': 'フォレスト・グリーン',
      'theme-mystic-teal': 'ミスティック・ティール',
      'theme-lime-lemon': 'ライム・レモン',
      'theme-trans-pride': 'トランス・プライド',
      'theme-radiant-amethyst': 'ラディアント・アメジスト',
      'theme-pride-rainbow': 'レインボー・プライド',
      'theme-lesbian-pride': 'レズビアン・プライド',
      'theme-bisexual-pride': 'バイセクシャル・プライド',
      'theme-asexual-pride': 'アセクシャル・プライド',
      'theme-opal': 'オパール',
      'theme-fire-red': 'ファイヤー・レッド',
      'theme-orange-citrus': 'オレンジ・シトラス',
      'theme-baby-blue': 'ベイビー・ブルー',
      'theme-passive-pink': 'パッシブ・ピンク',
      'theme-cyan-bliss': 'シアン・ブリス',
      'theme-lemon-lime': 'レモン・ライム',
      'theme-sparkling-amethyst': 'スパークリング・アメジスト',
      'theme-pansexual-pride': 'パンセクシャル・プライド',
      'theme-pansexual-joy': 'パンセクシャル・ジョイ',
      'theme-aromantic-pride': 'アロマンティック・プライド',
      'theme-aromantic-joy': 'アロマンティック・ジョイ',
      'theme-genderfluid-pride': 'ジェンダーフルイド・プライド',
      'theme-genderfluid-joy': 'ジェンダーフルイド・ジョイ',
      'theme-pomosexual-pride': 'ポモセクシャル・プライド',
      'theme-pomosexual-joy': 'ポモセクシャル・ジョイ',
      'theme-asexual-pride': 'アセクシャル・プライド',
      'theme-pride-rainbow-joy': 'レインボー・ジョイ',
      'theme-lesbian-joy': 'レズビアン・ジョイ',
      'theme-bisexual-joy': 'バイセクシャル・ジョイ',
      'theme-asexual-joy': 'アセクシャル・ジョイ',
      'theme-trans-joy': 'トランス・ジョイ'
    },
    ru: {
      'nav-home': 'Главная',
      'nav-marketplace': 'Маркет',
      'nav-about': 'О нас',
      'nav-settings': 'Настройки',
      'home-welcome': 'Добро пожаловать в Piyoverse.net',
      'upcoming-release': 'Предстоящий релиз:',
      'em-starcrest': 'Starcrest',
      'upcoming-desc': 'Готовьтесь к эпическому приключению! Starcrest — ожидаемый проект от Piyoverse Entertainment, эксклюзивно для Mega Drive.',
      'other-games': 'Другие игры и медиа',
      'explore-catalog': 'Просматривайте наш каталог игр, видео и других творческих материалов. Следите за обновлениями и новыми релизами!',
      'starcrest-md': 'Starcrest (Mega Drive)',
      'starcrest-gbc': 'Starcrest Adventure (Gameboy Color)',
      'music': 'Музыка',
      'about-heading': 'О Piyoverse Entertainment',
      'about-desc': 'Piyoverse Entertainment создаёт множество игр и творческих медиа. Наша команда сосредоточена на геймплее, визуале и звуковом дизайне.',
      'footer-copy': '© 2025 Piyoverse Entertainment. Все права защищены.',
      'legal-note': 'STARCREST, STARCREST ADVENTURE, ALIA, логотип PVE, логотип STARCREST и все связанные логотипы, персонажи и отличительные знаки являются товарными знаками и/или зарегистрированными товарными знаками Piyoverse Entertainment. Все права защищены.',
      'about-page-name': 'О нас',
      'marketplace-page-name': 'Маркет',
      'games-page-name': 'Игры',
      'music-page-name': 'Музыка',
      'settings-title': 'Настройки',
      'settings-header': 'Параметры сайта',
      'settings-audio-header': 'Аудио настройки',
      'settings-display-header': 'Отображение и доступность',
      'label-reduce-transparency': 'Уменьшить прозрачность:',
      'label-reduce-animation': 'Уменьшить анимацию:',
      'label-disable-ribbons': 'Отключить ленты и искры:',
      'label-language': 'Язык:',
      'label-theme-mode': 'Режим темы:',
      'label-theme': 'Тема:',
      'theme-dark': 'Тёмный режим',
      'theme-light': 'Светлый режим',
      'btn-save': 'Сохранить настройки',
      'social-youtube': 'Ютуб',
      'social-discord': 'Discord',
      'social-bsky': 'Bluesky',
      'social-twt': 'Twitter',
      'theme-obsidian': 'Обсидian',
        'theme-blood-maroon': 'Бордовый',
        'theme-brown-smog': 'Коричневый Смог',
        'theme-ocean-abyss': 'Океанская Бездна',
        'theme-forest-green': 'Лесной Зелёный',
        'theme-mystic-teal': 'Мистический Бирюзовый',
        'theme-lime-lemon': 'Лайм-Лимон',
        'theme-trans-pride': 'Транс-Прайд',
        'theme-radiant-amethyst': 'Сияющий Аметист',
        'theme-pride-rainbow': 'Радужный Прайд',
        'theme-lesbian-pride': 'Лесбийский Прайд',
        'theme-bisexual-pride': 'Бисексуальный Прайд',
        'theme-asexual-pride': 'Ассексуальный Прайд',
        'theme-opal': 'Опал',
        'theme-fire-red': 'Огненно-красный',
        'theme-orange-citrus': 'Апельсиновый Цитрус',
        'theme-baby-blue': 'Нежно-голубой',
        'theme-passive-pink': 'Пастельный Розовый',
        'theme-cyan-bliss': 'Циановое Блаженство',
        'theme-lemon-lime': 'Лимон-Лайм',
        'theme-sparkling-amethyst': 'Искрящийся Аметист',
        'theme-pansexual-pride': 'Пансексуальный Прайд',
        'theme-pansexual-joy': 'Пансексуальная Радость',
        'theme-aromantic-pride': 'Аромантический Прайд',
        'theme-aromantic-joy': 'Аромантическая Радость',
        'theme-genderfluid-pride': 'Гендерфлюидный Прайд',
        'theme-genderfluid-joy': 'Гендерфлюидная Радость',
        'theme-pomosexual-pride': 'Помосексуальный Прайд',
        'theme-pomosexual-joy': 'Помосексуальная Радость',
        'theme-asexual-pride': 'Ассексуальный Прайд',
        'theme-pride-rainbow-joy': 'Радужная Радость',
        'theme-lesbian-joy': 'Лесбийская Радость',
        'theme-bisexual-joy': 'Бисексуальная Радость',
        'theme-asexual-joy': 'Ассексуальная Радость',
        'theme-trans-joy': 'Транс Радость'
    }
    ,
    es: {
      'nav-home': 'Inicio',
      'nav-marketplace': 'Mercado',
      'nav-about': 'Acerca de',
      'nav-settings': 'Ajustes',
      'home-welcome': 'Bienvenido a Piyoverse.net',
      'upcoming-release': 'Próximo lanzamiento:',
      'upcoming-desc': '¡Prepárate para una aventura épica! Starcrest es un próximo proyecto de Piyoverse Entertainment, solo para Mega Drive.',
      'em-starcrest': 'Starcrest',
      'other-games': 'Otros juegos y medios',
      'explore-catalog': 'Explora nuestro catálogo de juegos, vídeos y otros medios creativos. ¡Estate atento a actualizaciones y lanzamientos!',
      'starcrest-md': 'Starcrest (Mega Drive)',
      'starcrest-gbc': 'Starcrest Adventure (Gameboy Color)',
      'music': 'Música',
      'about-heading': 'Acerca de Piyoverse Entertainment',
      'about-desc': 'Piyoverse Entertainment crea multitud de juegos y medios creativos. Nuestro equipo se centra en la jugabilidad, lo visual y el diseño sonoro.',
      'footer-copy': '© 2025 Piyoverse Entertainment. Todos los derechos reservados.',
      'legal-note': 'STARCREST, STARCREST ADVENTURE, ALIA, el logo PVE, el logo STARCREST y todos los logos, personajes y marcas distintivas afiliadas son marcas comerciales y/o marcas registradas de Piyoverse Entertainment. Todos los derechos reservados.',
      'about-page-name': 'Acerca de',
      'marketplace-page-name': 'Mercado',
      'games-page-name': 'Juegos',
      'music-page-name': 'Música',
      'settings-title': 'Ajustes',
      'settings-header': 'Ajustes del sitio',
      'settings-audio-header': 'Ajustes de audio',
      'settings-display-header': 'Pantalla y accesibilidad',
      'label-reduce-transparency': 'Reducir transparencia:',
      'label-reduce-animation': 'Reducir animación:',
      'label-disable-ribbons': 'Desactivar cintas y destellos:',
      'label-language': 'Idioma:',
      'label-theme-mode': 'Modo de tema:',
      'label-theme': 'Tema:',
      'theme-dark': 'Modo oscuro',
      'theme-light': 'Modo claro',
      'btn-save': 'Guardar ajustes',
      'social-youtube': 'YouTube',
      'social-discord': 'Discord',
      'social-bsky': 'Bluesky',
      'social-twt': 'Twitter',
      'theme-obsidian': 'Obsidiana',
      'theme-blood-maroon': 'Granate',
      'theme-brown-smog': 'Marrón Smog',
      'theme-ocean-abyss': 'Abismo Oceánico',
      'theme-forest-green': 'Verde Bosque',
      'theme-mystic-teal': 'Verde Azulado Místico',
      'theme-lime-lemon': 'Lima-Limón',
      'theme-radiant-amethyst': 'Amatista Radiante',
      'theme-pride-rainbow': 'Orgullo Arcoíris',
      'theme-lesbian-pride': 'Orgullo Lésbico',
      'theme-bisexual-pride': 'Orgullo Bisexual',
      'theme-asexual-pride': 'Orgullo Asexual',
      'theme-trans-pride': 'Orgullo Trans',
      'theme-pansexual-pride': 'Orgullo Pansexual',
      'theme-aromantic-pride': 'Orgullo Aromántico',
      'theme-genderfluid-pride': 'Orgullo Genderfluid',
      'theme-pomosexual-pride': 'Orgullo Pomosexual',
      'theme-opal': 'Ópalo',
      'theme-fire-red': 'Rojo Fuego',
      'theme-orange-citrus': 'Naranja Cítrica',
      'theme-baby-blue': 'Azul Bebé',
      'theme-passive-pink': 'Rosa Pastel',
      'theme-cyan-bliss': 'Cian Placentero',
      'theme-lemon-lime': 'Limón-Lima',
      'theme-sparkling-amethyst': 'Amatista Brillante',
      'theme-pride-rainbow-joy': 'Arcoíris Alegría',
      'theme-lesbian-joy': 'Alegría Lésbica',
      'theme-bisexual-joy': 'Alegría Bisexual',
      'theme-asexual-joy': 'Alegría Asexual',
      'theme-trans-joy': 'Alegría Trans',
      'theme-pansexual-joy': 'Alegría Pansexual',
      'theme-aromantic-joy': 'Alegría Aromántica',
      'theme-genderfluid-joy': 'Alegría Genderfluid',
      'theme-pomosexual-joy': 'Alegría Pomosexual'
    }
  };


function applyI18n(lang) {
  var dict = I18N[lang] || I18N['en'];
  var nodes = document.querySelectorAll('[data-i18n]');
  for(var i=0;i<nodes.length;i++){
    var key = nodes[i].getAttribute('data-i18n');
    if(dict[key]) nodes[i].textContent = dict[key];
  }
}
 
// Text-based translations map (fallback for content without data-i18n attributes)
var TRANSLATIONS = {
  en: {},
  ja: {
    'Home': 'ホーム',
    'Marketplace': 'マーケット',
    'About': '概要',
    'Settings': '設定',
    'Welcome to Piyoverse.net': 'ピヨバースへようこそ',
    'Upcoming Release:': '今後のリリース：',
    'Get ready for an epic adventure! Starcrest is an upcoming creation from Piyoverse Entertainment, only for the Mega Drive.': '壮大な冒険の準備をしてください！スタークレストはピヨバース・エンターテインメント（Piyoverse Entertainment）によるMega Drive専用の新作です。',
    'Other Games & Media': 'その他のゲームとメディア',
    'Explore our catalog of games, videos, and other creative media. Stay tuned for new updates and releases!': 'ゲーム、ビデオ、その他のクリエイティブなメディアのカタログをチェックしてください。新しいアップデートやリリースにご期待ください！',
    'Games': 'ゲーム',
    'Music': '音楽',
    'Back to Marketplace': 'マーケットへ戻る',
    'Piyoverse Originals': 'ピヨバース オリジナル',
    'Album — Released March 2024': 'アルバム — 2024年3月リリース',
    'Album': 'アルバム',
    'Single': 'シングル',
    'Featured': '注目',
    'Artist': 'アーティスト',
    'Settings saved!': '設定が保存されました！',
    'Save Settings': '設定を保存',
    'Language:': '言語：',
    'Theme Mode:': 'テーマモード：',
    'Theme:': 'テーマ：',
    'Dark Mode': 'ダークモード',
    'Light Mode': 'ライトモード',
    'YouTube': 'ユーチューブ',
    'Discord': 'ディスコード',
    'Bluesky': 'ブルースカイ',
    'Twitter': 'ツイッター',
    'Preorder': '予約注文',
    'Download Demo': 'デモをダウンロード',
    'Piyoverse': 'ピヨバース',
    'Piyoverse Entertainment': 'ピヨバース・エンターテインメント（Piyoverse Entertainment）',
    'Entertainment': 'エンターテインメント',
    'entertainment': 'エンターテインメント',
    'Adventure': 'アドベンチャー',
    'Hexpress': 'ヘクスプレス',
    'Dungeon Escape': 'ダンジョン・エスケープ',
    'Cliff Climber': 'クリフ・クライマー',
    'platform': 'プラットフォーム',
    'Platform:': 'プラットフォーム：',
    'Platform: TBD': 'プラットフォーム：未定',
    'TBD': '未定',
    'Mega Drive': 'メガドライブ',
    'Game Boy Color': 'ゲームボーイカラー',
    'Gameboy Color': 'ゲームボーイカラー',
    'Developer:': '開発：',
    'Developer': '開発',
    'Artist:': 'アーティスト：',
    'Artist': 'アーティスト',
    'Released': 'リリース',
    'January': '1月',
    'February': '2月',
    'March': '3月',
    'April': '4月',
    'May': '5月',
    'June': '6月',
    'July': '7月',
    'August': '8月',
    'September': '9月',
    'October': '10月',
    'November': '11月',
    'December': '12月',
    'Featured Games': '注目のゲーム',
    'Featured': '注目',
    'Starcrest': 'スタークレスト',
    'Home': 'ホーム'
  },
  ru: {
    'Home': 'Главная',
    'Marketplace': 'Маркет',
    'About': 'О нас',
    'Settings': 'Настройки',
    'Welcome to Piyoverse.net': 'Добро пожаловать в Piyoverse.net',
    'Upcoming Release:': 'Предстоящий релиз:',
    'Get ready for an epic adventure! Starcrest is an upcoming creation from Piyoverse Entertainment, only for the Mega Drive.': 'Готовьтесь к эпическому приключению! Starcrest — проект Piyoverse Entertainment для Mega Drive.',
    'Other Games & Media': 'Другие игры и медиа',
    'Explore our catalog of games, videos, and other creative media. Stay tuned for new updates and releases!': 'Ознакомьтесь с нашим каталогом игр, видео и других творческих материалов. Следите за обновлениями и релизами!',
    'Games': 'Игры',
    'Music': 'Музыка',
    'Back to Marketplace': 'Назад к маркету',
    'Piyoverse Originals': 'Оригиналы Piyoverse',
    'Album — Released March 2024': 'Альбом — Выпущен в марте 2024',
    'Album': 'Альбом',
    'Single': 'Сингл',
    'Featured': 'Рекомендуем',
    'Artist': 'Артист',
    'Settings saved!': 'Настройки сохранены!',
    'Save Settings': 'Сохранить настройки',
    'Language:': 'Язык:',
    'Theme Mode:': 'Режим темы:',
    'Theme:': 'Тема:',
    'Dark Mode': 'Тёмный режим',
    'Light Mode': 'Светлый режим',
    'YouTube': 'Ютуб',
    'Discord': 'Discord',
    'Bluesky': 'Bluesky',
    'Twitter': 'Twitter',
    'Preorder': 'Предзаказ',
    'Download Demo': 'Скачать демо',
    'Piyoverse': 'Пийоверс',
    'Piyoverse Entertainment': 'Пийоверс Энтертейнмент (Piyoverse Entertainment)',
    'Entertainment': 'Развлечения',
    'entertainment': 'развлечения',
    'Adventure': 'Приключение',
    'Hexpress': 'Хекспресс',
    'Dungeon Escape': 'Побег из подземелья',
    'Cliff Climber': 'Скалолаз',
    'platform': 'Платформа',
    'Platform:': 'Платформа:',
    'Platform: TBD': 'Платформа: TBD',
    'TBD': 'Не определено',
    'Mega Drive': 'Mega Drive',
    'Game Boy Color': 'Game Boy Color',
    'Gameboy Color': 'Game Boy Color',
    'Developer:': 'Разработчик:',
    'Developer': 'Разработчик',
    'Artist:': 'Артист:',
    'Artist': 'Артист',
    'Released': 'Релиз',
    'January': 'январь',
    'February': 'февраль',
    'March': 'март',
    'April': 'апрель',
    'May': 'май',
    'June': 'июнь',
    'July': 'июль',
    'August': 'август',
    'September': 'сентябрь',
    'October': 'октябрь',
    'November': 'ноябрь',
    'December': 'декабрь',
    'Featured Games': 'Рекомендуемые игры',
    'Featured': 'Рекомендуем',
    'Starcrest': 'Старкрест',
    'Home': 'Главная'
  }
  ,
  es: {
    'nav-home': 'Inicio',
    'nav-marketplace': 'Mercado',
    'nav-about': 'Acerca de',
    'nav-settings': 'Ajustes',
    'home-welcome': 'Bienvenido a Piyoverse.net',
    'upcoming-release': 'Próximo lanzamiento:',
    'em-starcrest': 'Starcrest',
    'upcoming-desc': '¡Prepárate para una aventura épica! Starcrest es un próximo proyecto de Piyoverse Entertainment, solo para Mega Drive.',
    'other-games': 'Otros juegos y medios',
    'explore-catalog': 'Explora nuestro catálogo de juegos, vídeos y otros medios creativos. ¡Estate atento a actualizaciones y lanzamientos!',
    'starcrest-md': 'Starcrest (Mega Drive)',
    'starcrest-gbc': 'Starcrest Adventure (Gameboy Color)',
    'music': 'Música',
    'about-heading': 'Acerca de Piyoverse Entertainment',
    'about-desc': 'Piyoverse Entertainment crea multitud de juegos y medios creativos. Nuestro equipo se centra en la jugabilidad, lo visual y el diseño sonoro.',
    'footer-copy': '© 2025 Piyoverse Entertainment. Todos los derechos reservados.',
    'legal-note': 'STARCREST, STARCREST ADVENTURE, ALIA, el logo PVE, el logo STARCREST y todos los logos, personajes y marcas distintivas afiliadas son marcas comerciales y/o marcas registradas de Piyoverse Entertainment. Todos los derechos reservados.',
    'about-page-name': 'Acerca de',
    'marketplace-page-name': 'Mercado',
    'games-page-name': 'Juegos',
    'music-page-name': 'Música',
    'settings-title': 'Ajustes',
    'settings-header': 'Ajustes del sitio',
    'label-language': 'Idioma:',
    'label-theme-mode': 'Modo de tema:',
    'label-theme': 'Tema:',
    'theme-dark': 'Modo oscuro',
    'theme-light': 'Modo claro',
    'btn-save': 'Guardar ajustes',
    'social-youtube': 'YouTube',
    'social-discord': 'Discord',
    'social-bsky': 'Bluesky',
    'social-twt': 'Twitter',
    'theme-obsidian': 'Obsidiana',
    'theme-blood-maroon': 'Granate',
    'theme-brown-smog': 'Nevizco Marrón',
    'theme-ocean-abyss': 'Abismo Oceánico',
    'theme-forest-green': 'Verde Bosque',
    'theme-mystic-teal': 'Verde Azulado Místico',
    'theme-lime-lemon': 'Lima-Limón',
    'theme-trans-pride': 'Orgullo Trans',
    'theme-radiant-amethyst': 'Amatista Radiante',
    'theme-pride-rainbow': 'Arcoíris Pride',
    'theme-lesbian-pride': 'Orgullo Lésbico',
    'theme-bisexual-pride': 'Orgullo Bisexual',
    'theme-asexual-pride': 'Orgullo Asexual',
    'theme-opal': 'Ópalo',
    'theme-fire-red': 'Rojo Fuego',
    'theme-orange-citrus': 'Naranja Cítrica',
    'theme-baby-blue': 'Azul Bebé',
    'theme-passive-pink': 'Rosa Pastel',
    'theme-cyan-bliss': 'Cian Placentero',
    'theme-lemon-lime': 'Limón-Lima',
    'theme-sparkling-amethyst': 'Amatista Brillante',
    'theme-pansexual-pride': 'Orgullo Pansexual',
    'theme-pansexual-joy': 'Alegría Pansexual',
    'theme-aromantic-pride': 'Orgullo Aromántico',
    'theme-aromantic-joy': 'Alegría Aromántica',
    'theme-genderfluid-pride': 'Orgullo Genderfluid',
    'theme-genderfluid-joy': 'Alegría Genderfluid',
    'theme-pomosexual-pride': 'Orgullo Pomosexual',
    'theme-pomosexual-joy': 'Alegría Pomosexual',
    'theme-asexual-pride': 'Orgullo Asexual',
    'theme-pride-rainbow-joy': 'Arcoíris Alegría',
    'theme-lesbian-joy': 'Alegría Lésbica',
    'theme-bisexual-joy': 'Alegría Bisexual',
    'theme-asexual-joy': 'Alegría Asexual',
    'theme-trans-joy': 'Alegría Trans'
  }
};

// Add TRANSLATIONS.es for Spanish text replacements
TRANSLATIONS.es = {
  'Home': 'Inicio',
  'Marketplace': 'Mercado',
  'About': 'Acerca de',
  'Settings': 'Ajustes',
  'Welcome to Piyoverse.net': 'Bienvenido a Piyoverse.net',
  'Upcoming Release:': 'Próximo lanzamiento:',
  'Get ready for an epic adventure! Starcrest is an upcoming creation from Piyoverse Entertainment, only for the Mega Drive.': '¡Prepárate para una aventura épica! Starcrest es un próximo proyecto de Piyoverse Entertainment, solo para Mega Drive.',
  'Other Games & Media': 'Otros juegos y medios',
  'Explore our catalog of games, videos, and other creative media. Stay tuned for new updates and releases!': 'Explora nuestro catálogo de juegos, vídeos y otros medios creativos. ¡Atento a actualizaciones y lanzamientos!',
  'Games': 'Juegos',
  'Music': 'Música',
  'Back to Marketplace': 'Volver al mercado',
  'Piyoverse Originals': 'Originales de Piyoverse',
  'Album — Released March 2024': 'Álbum — Publicado en marzo de 2024',
  'Album': 'Álbum',
  'Single': 'Sencillo',
  'Featured': 'Destacado',
  'Artist': 'Artista',
  'Settings saved!': '¡Ajustes guardados!',
  'Save Settings': 'Guardar ajustes',
  'Language:': 'Idioma:',
  'Theme Mode:': 'Modo de tema:',
  'Theme:': 'Tema:',
  'Dark Mode': 'Modo oscuro',
  'Light Mode': 'Modo claro',
  'YouTube': 'YouTube',
  'Discord': 'Discord',
  'Bluesky': 'Bluesky',
  'Twitter': 'Twitter',
  'Preorder': 'Reservar',
  'Download Demo': 'Descargar demo',
  'Piyoverse': 'Piyoverse',
  'Piyoverse Entertainment': 'Piyoverse Entertainment',
  'Entertainment': 'Entretenimiento',
  'entertainment': 'entretenimiento',
  'Adventure': 'Aventura',
  'Hexpress': 'Hexpress',
  'Dungeon Escape': 'Escape de la Mazmorra',
  'Cliff Climber': 'Escalador de Acantilados',
  'platform': 'Plataforma',
  'Platform:': 'Plataforma:',
  'Platform: TBD': 'Plataforma: Por determinar',
  'TBD': 'Por determinar',
  'Mega Drive': 'Mega Drive',
  'Game Boy Color': 'Game Boy Color',
  'Gameboy Color': 'Game Boy Color',
  'Developer:': 'Desarrollador:',
  'Developer': 'Desarrollador',
  'Artist:': 'Artista:',
  'Artist': 'Artista',
  'Released': 'Publicado',
  'January': 'enero',
  'February': 'febrero',
  'March': 'marzo',
  'April': 'abril',
  'May': 'mayo',
  'June': 'junio',
  'July': 'julio',
  'August': 'agosto',
  'September': 'septiembre',
  'October': 'octubre',
  'November': 'noviembre',
  'December': 'diciembre',
  'Featured Games': 'Juegos destacados',
  'Featured': 'Destacado',
  'Starcrest': 'Starcrest',
  'Home': 'Inicio'
};

// Add game description translations for Japanese and Russian
TRANSLATIONS.ja['An action-adventure game currently in development.'] = '現在開発中のアクションアドベンチャーゲームです。';
TRANSLATIONS.ja['A prototype demo exploring series mechanics on handheld hardware.'] = 'ハンドヘルド機向けにシリーズのメカニクスを試作したプロトタイプデモです。';
TRANSLATIONS.ja['Featured game.'] = '注目のゲームです。';

TRANSLATIONS.ru['An action-adventure game currently in development.'] = 'Экшн-приключение, в настоящее время в разработке.';
TRANSLATIONS.ru['A prototype demo exploring series mechanics on handheld hardware.'] = 'Прототип-демо, исследующий механику серии на портативном устройстве.';
TRANSLATIONS.ru['Featured game.'] = 'Рекомендуемая игра.';

// Walk text nodes and replace exact matches from TRANSLATIONS[lang]

// Spanish game description translations
TRANSLATIONS.es['An action-adventure game currently in development.'] = 'Un juego de acción y aventura actualmente en desarrollo.';
TRANSLATIONS.es['A prototype demo exploring series mechanics on handheld hardware.'] = 'Un prototipo demostración que explora las mecánicas de la serie en hardware portátil.';
TRANSLATIONS.es['Featured game.'] = 'Juego destacado.';

function applyTextTranslations(lang) {
  try {
    var map = TRANSLATIONS[lang] || {};
    // Build keys array for iteration (IE11-safe)
    var keys = [];
    for (var k in map) if (map.hasOwnProperty(k)) keys.push(k);

    // Detect if this is the music (albums) page so we can avoid translating album titles
    var isMusicPage = false;
    try {
      if (document.querySelector && document.querySelector('[data-i18n="music-page-name"]')) isMusicPage = true;
      // fallback: check title contains Music
      if (!isMusicPage && document.title && document.title.indexOf('Music') !== -1) isMusicPage = true;
    } catch(e) { isMusicPage = false; }

    function shouldSkip(node) {
      if (!node || !node.parentNode) return true;
      var n = node.parentNode.nodeName;
      return (n === 'SCRIPT' || n === 'STYLE' || n === 'TEXTAREA' || n === 'CODE' || n === 'PRE');
    }

    // Text node walker
    var walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
    var tnode = walker.nextNode();
    while (tnode) {
      if (!shouldSkip(tnode)) {
        var txt = tnode.nodeValue;
        // If this text node is inside a game title on the music page, skip translation
        if (isMusicPage) {
          try {
            var p = tnode.parentNode;
            while (p && p !== document.body) {
              if (p.classList && p.classList.contains && p.classList.contains('game-title')) {
                // do not translate album title text
                txt = txt; // no-op, keep original
                break;
              }
              p = p.parentNode;
            }
            // If we found a game-title ancestor, move to next node without changes
            if (p && p !== document.body && p.classList && p.classList.contains && p.classList.contains('game-title')) {
              tnode = walker.nextNode();
              continue;
            }
          } catch(e) {}
        }
        if (txt && txt.trim().length) {
                // Use a safe substring-replace that checks surrounding characters
                // to avoid replacing inside already-translated words or missing
                // keys that include punctuation (e.g. 'Platform:'). This approach
                // is IE11-friendly and avoids lookbehind/lookahead regexes.
                function isAlphaNum(ch) {
                  if (!ch) return false;
                  return /[A-Za-z0-9_À-ÖØ-öø-ÿ]/.test(ch);
                }
                function replaceSafe(text, src, dst) {
                  if (!src) return text;
                  var out = '';
                  var idx = 0;
                  var found = text.indexOf(src, idx);
                  while (found !== -1) {
                    var before = found > 0 ? text.charAt(found-1) : '';
                    var after = (found + src.length) < text.length ? text.charAt(found + src.length) : '';
                    // Only replace if src is not embedded in a larger word (letters/digits)
                    if (!isAlphaNum(before) && !isAlphaNum(after)) {
                      out += text.substring(idx, found) + dst;
                    } else {
                      out += text.substring(idx, found + src.length);
                    }
                    idx = found + src.length;
                    found = text.indexOf(src, idx);
                  }
                  out += text.substring(idx);
                  return out;
                }
                for (var i=0;i<keys.length;i++){
                  var src = keys[i];
                  var dst = map[src];
                  if (txt.indexOf(src) !== -1) txt = replaceSafe(txt, src, dst);
                }
          tnode.nodeValue = txt;
        }
      }
      tnode = walker.nextNode();
    }

    // Translate common attributes: alt, aria-label, title, placeholder (replace fragments)
    var attrNames = ['alt','aria-label','title','placeholder'];
    var all = document.getElementsByTagName('*');
    for (var ei=0; ei<all.length; ei++){
      var el = all[ei];
      // If on music page and this element is inside an album card, skip attribute replacements
      var skipAttrReplace = false;
      if (isMusicPage) {
        try {
          var anc = el;
          while (anc && anc !== document.body) {
            if (anc.classList && anc.classList.contains && anc.classList.contains('game-card')) break;
            anc = anc.parentNode;
          }
          if (anc && anc !== document.body && anc.classList && anc.classList.contains && anc.classList.contains('game-card')) {
            // Check if this card lists 'Album' in any .game-meta entries
            var metas = anc.getElementsByClassName('game-meta');
            for (var mi=0; mi<metas.length; mi++){
              try {
                var mtext = metas[mi].textContent || '';
                var mlower = (mtext || '').toLowerCase();
                // Accept both English 'Album' and Spanish 'Álbum' (and lowercase variants)
                if (mlower.indexOf('album') !== -1 || mlower.indexOf('álbum') !== -1) { skipAttrReplace = true; break; }
              } catch(e){}
            }
          }
        } catch(e) { skipAttrReplace = false; }
      }
      if (skipAttrReplace) continue;
      for (var ai=0; ai<attrNames.length; ai++){
        var an = attrNames[ai];
        if (el.hasAttribute && el.hasAttribute(an)) {
          var aval = el.getAttribute(an);
            if (aval) {
            var newval = aval;
            for (var ki=0; ki<keys.length; ki++){
              var srcK = keys[ki];
              var dstK = map[srcK];
              if (newval.indexOf(srcK) !== -1) newval = replaceSafe(newval, srcK, dstK);
            }
            if (newval !== aval) el.setAttribute(an, newval);
          }
        }
      }
    }
    // Also translate the document title (and head <title>) by replacing any mapped fragments
    try {
      var docTitle = document.title || '';
      if (docTitle && keys.length) {
        try {
          for (var ki=0; ki<keys.length; ki++){
            var srcK = keys[ki];
            var dstK = map[srcK];
            if (docTitle.indexOf(srcK) !== -1) docTitle = replaceSafe(docTitle, srcK, dstK);
          }
        } catch(e) {}
        document.title = docTitle;
        var headTitle = document.getElementsByTagName('title')[0];
        if (headTitle) headTitle.textContent = docTitle;
      }
    } catch (e) {}
  } catch (e) {
    // fail silently on older browsers
  }
}

// Settings logic for language and theme persistence
document.addEventListener('DOMContentLoaded', function() {
  // Theme definitions
  var themes = {
    dark: [
      /* Normal/durable themes */
      {id:'obsidian',name:'Obsidian'},
      {id:'blood-maroon',name:'Blood Maroon'},
      {id:'brown-smog',name:'Brown Smog'},
      {id:'ocean-abyss',name:'Ocean Abyss'},
      {id:'forest-green',name:'Forest Green'},
      {id:'mystic-teal',name:'Mystic Teal'},
      {id:'lime-lemon',name:'Lime-Lemon'},
      {id:'radiant-amethyst',name:'Radiant Amethyst'},

      /* Pride themes (dark "Pride" variants) grouped together */
      {id:'pride-rainbow',name:'Rainbow Pride'},
      {id:'lesbian-pride',name:'Lesbian Pride'},
      {id:'bisexual-pride',name:'Bisexual Pride'},
      {id:'asexual-pride',name:'Asexual Pride'},
      {id:'trans-pride',name:'Trans Pride'},
      {id:'pansexual-pride',name:'Pansexual Pride'},
      {id:'aromantic-pride',name:'Aromantic Pride'},
      {id:'genderfluid-pride',name:'Genderfluid Pride'},
      {id:'pomosexual-pride',name:'Pomosexual Pride'}
    ],
    light: [
      /* Normal/light themes */
      {id:'opal',name:'Opal'},
      {id:'fire-red',name:'Fire Red'},
      {id:'orange-citrus',name:'Orange Citrus'},
      {id:'baby-blue',name:'Baby Blue'},
      {id:'passive-pink',name:'Passive Pink'},
      {id:'cyan-bliss',name:'Cyan Bliss'},
      {id:'lemon-lime',name:'Lemon-Lime'},
      {id:'sparkling-amethyst',name:'Sparkling Amethyst'},

      /* Joy (light) variants grouped together */
      {id:'pride-rainbow-joy',name:'Rainbow Joy'},
      {id:'lesbian-joy',name:'Lesbian Joy'},
      {id:'bisexual-joy',name:'Bisexual Joy'},
      {id:'asexual-joy',name:'Asexual Joy'},
      {id:'trans-joy',name:'Trans Joy'},
      {id:'pansexual-joy',name:'Pansexual Joy'},
      {id:'aromantic-joy',name:'Aromantic Joy'},
      {id:'genderfluid-joy',name:'Genderfluid Joy'},
      {id:'pomosexual-joy',name:'Pomosexual Joy'}
    ]
  };

  // Utility
  function setPref(key, val) { try { localStorage.setItem(key, val); } catch(e){} }
  function getPref(key, fallback) { try { var v=localStorage.getItem(key); return v!==null?v:fallback; } catch(e){return fallback;} }

  // Apply language
  function applyLanguage(lang) {
    document.documentElement.lang = lang;
    setPref('site-language', lang);
    __currentLang = lang;
    applyI18n(lang);
    applyTextTranslations(lang);
    // Dispatch an event for other scripts (if needed)
    try { var ev = document.createEvent('Event'); ev.initEvent('site-language-changed', true, true); ev.language = lang; document.dispatchEvent(ev); } catch(e) {}
  }

  // Sometimes browsers (or optimization extensions) alter DOM content after images load
  // — provide a short polling fallback to reapply translations for a few seconds.
  function transientReapply(durationMs, intervalMs) {
    try {
      durationMs = durationMs || 5000;
      intervalMs = intervalMs || 400;
      var elapsed = 0;
      var tid = setInterval(function(){
        try { reapplyTranslations(); } catch(e){}
        elapsed += intervalMs;
        if (elapsed >= durationMs) try { clearInterval(tid); } catch(e){}
      }, intervalMs);
    } catch(e){}
  }

  // Keep track of current language and reapply translations when DOM changes
  var __currentLang = getPref('site-language','en');
  var __mo = null;
  function reapplyTranslations() {
    try {
      // If we have an observer, temporarily disconnect to avoid feedback loops
      try { if (__mo) __mo.disconnect(); } catch(e){}
      applyI18n(__currentLang);
      applyTextTranslations(__currentLang);
    } catch (e) {}
    try { if (__mo) __mo.observe(document.body, { childList: true, subtree: true }); } catch(e){}
  }

  // Observe DOM changes and reapply translations (MutationObserver is IE11-compatible)
  (function(){
    var applyTimer = null;
    var localMo = null;
    if (window.MutationObserver) {
      try {
        localMo = new MutationObserver(function(mutations){
          if (applyTimer) clearTimeout(applyTimer);
          applyTimer = setTimeout(reapplyTranslations, 120);
        });
        localMo.observe(document.body, { childList: true, subtree: true });
        // expose to reapplyTranslations so it can disconnect/reconnect
        __mo = localMo;
      } catch(e) {}
    } else {
      // Fallback: reapply on each image load
      var imgs = document.getElementsByTagName('img');
      for (var ii=0; ii<imgs.length; ii++) {
        try { imgs[ii].addEventListener('load', reapplyTranslations); } catch(e){}
      }
      // Also reapply on window load
      try { window.addEventListener('load', reapplyTranslations); } catch(e){}
    }
  })();

  // Apply theme
  function applyTheme(mode, themeId) {
    document.documentElement.setAttribute('data-theme-mode', mode);
    document.documentElement.setAttribute('data-theme', themeId);
    setPref('site-theme-mode', mode);
    setPref('site-theme', themeId);
    // Optionally: update ribbons-of-life.js theme if it supports them
    if(window.ribbonsSetTheme) window.ribbonsSetTheme(mode, themeId);
  }

  // Theme variant selection removed — only `data-theme-mode` (dark/light) is exposed.

  // On settings page
  if(document.getElementById('settings-form')) {
    var langSel = document.getElementById('language');
    var modeSel = document.getElementById('theme-mode');
    // Load saved
    var savedLang = getPref('site-language','en');
    var savedMode = getPref('site-theme-mode','dark');
    langSel.value = savedLang;
    modeSel.value = savedMode;
    // music / sfx toggles
    try { var savedMusic = getPref('site-music','on'); var mt = document.getElementById('music-toggle'); if(mt) mt.value = savedMusic; } catch(e) {}
    try { var savedSfx = getPref('site-sfx','on'); var st = document.getElementById('sfx-toggle'); if(st) st.value = savedSfx; } catch(e) {}
    // Change events
    langSel.onchange = function(){ applyLanguage(langSel.value); };
    modeSel.onchange = function(){
      var currentTheme = getPref('site-theme','obsidian');
      applyTheme(modeSel.value, currentTheme);
    };
    // On submit
    document.getElementById('settings-form').onsubmit = function(e){
      e.preventDefault();
      applyLanguage(langSel.value);
      var currentTheme = getPref('site-theme','obsidian');
      applyTheme(modeSel.value, currentTheme);
      try { var musicVal = document.getElementById('music-toggle').value; setPref('site-music', musicVal); } catch(e) {}
      try { var sfxVal = document.getElementById('sfx-toggle').value; setPref('site-sfx', sfxVal); } catch(e) {}
      try { window.siteMusicEnabled = (getPref('site-music','on') === 'on'); window.siteSfxEnabled = (getPref('site-sfx','on') === 'on'); } catch(e) {}
      try{ if(window.siteMusicEnabled && window.siteEnsureMusicPlaying) window.siteEnsureMusicPlaying(); else { try{ var __ma = document.getElementById('piyoverse-music'); if(__ma){ try{ __ma.pause(); __ma.volume = 0; }catch(e){} } }catch(e){} }catch(e){}
      alert('Settings saved!');
    };
  }

  // On every page: apply saved settings
  var lang = getPref('site-language','en');
  var mode = getPref('site-theme-mode','dark');
  var theme = getPref('site-theme','obsidian');
  applyLanguage(lang);
  applyTheme(mode, theme);
  // Apply theme mode on load (dark/light)
  try { var modeNow = getPref('site-theme-mode','dark'); applyTheme(modeNow, getPref('site-theme','obsidian')); } catch(e) {}
  // transiently reapply for a short window to cover lazy loads / browser optimizations
  transientReapply(5000, 400);
  try { window.siteMusicEnabled = (getPref('site-music','on') === 'on'); window.siteSfxEnabled = (getPref('site-sfx','on') === 'on'); } catch(e) {}
});
